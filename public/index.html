<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Discoodle</title>
    <link rel='stylesheet' href='https://codepen.io/tutsplus/pen/WROvdG.css'>
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/css/materialize.min.css'>
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css'><link rel="stylesheet" href="./style.css">
  <script src='/socket.io/socket.io.js'></script>
  <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
  <script src='https://code.jquery.com/jquery-3.4.1.min.js'></script>
  <style>
    #video-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, 300px);
      grid-auto-rows: 300px;
    }
    
    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  </style>
  

</head>
<body style="background-color: #2c2f33;">
    <div class="content-box"></div>
    <div id="message"></div>
    
    <div class="container">
        <div class="row-full">
          <div class="col s12 l19">
            <div class="discord-mockup z-depth-3">
              <div class="items-panel">
                <div class="items">
                  <div class="item">
                    <div id="item">
                      <button class="guild-add">A</button>
                      <button class="guild-add">B</button>
                      <button class="guild-add">C</button>
                      <button class="guild-add">D</button>
                      <button class="guild-add">E</button>
                    </div>  
                    <button class="guild-add" onclick="addChan()">+</button>
                  </div>
                </div>
              </div>
              <div class="sidebar-panel hide-on-med-and-down">
                <div class="header">Projet de Programmation</div>
                <div class="items"><a href="#">
                    <div class="item trigger-group" data="Progra">Programmation</div>
                    <div class="item trigger-group" data="ea4">EA4</div>
                    <div class="item trigger-group" data="Stats">Stats</div>
                    <div class="item trigger-group" data="Video">Appel Vidéo</div>
                </a></div>
              </div>
              <div class="messages-panel" id="messages-panel">
                <div class="test" id="test">
                  <div class="messages-group hide-unless-show" id="Progra">
                    <div class="header">Général</div>
                    <div class="messages" id = "Progra0">
                    </div>
                  </div>
                  <div class="messages-group hide-unless-show" id="ea4">
                    <div class="header">ea4</div>
                    <div class="messages" id = "ea40">
                      <div class="message">
                        <div class="icon"><img class="responsive-img" src="./ProfilDefault.png"/></div>
                        <div class="body">
                          <div class="user-name">Gnar</div>
                          <div class="content">I'm lonely.</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="messages-group hide-unless-show" id="Stats">
                    <div class="header">Stats</div>
                    <div class="messages">
                      <div class="message"  id = "Stats0">
                        <div class="icon"><img class="responsive-img" src="./ProfilDefault.png"/></div>
                        <div class="body">
                          <div class="user-name">Gnar</div>
                          <div class="content">Non-embedded message.</div>
                        </div>
                      </div>
                    </div>
                  </div>


                  <!-- WebRTC Integration - Sur clic du bouton-->
                  <div class="messages-group hide-unless-show" id="Video">
                    <div class="header">Vidéo chat</div>
                    <div class="messages">
                      <div class="main-video">
                        <button onclick="initVid()">Appel Vidéo</button>
                        <div id="video-grid"></div>
                      </div>
                    </div>
                  </div>


                </div>
                <div class="msg-input">
                  <form action="" class="msg-form">
                    <input id = "msg" autocomplete="off" class="msg-input"/><button class="msg-button">Envoyer</button>
                  </form>
                </div>
              </div>
            </div>
            
          </div>
        </div>
    </div>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script><script  src="./script.js"></script><script  src="./video.js"></script>
    <script>
      var a = 69;
        function get(name){
            var url = window.location.search;
            var num = url.search(name);
            var namel = name.length;
            var frontlength = namel+num+1; //length of everything before the value 
            var front = url.substring(0, frontlength);  
            url = url.replace(front, "");  
            num = url.search("&");
            if(num>=0) return url.substr(0,num); 
            if(num<0)  return url;             
        }


        function addChan(){
          a++;
          var res = String.fromCharCode(a);
          document.getElementById('item').insertAdjacentHTML('beforeEnd','<button class="guild-add">' + res + '</button>');
        }

        $(function (){
            var socket = io();
            const def = "Utilisateur"
            const name = prompt('Entrer votre nom:',def);
            while(name.length == 0 ){
                name = prompt('Entrer votre nom:');
            }
            socket.emit('user-created',name);
           
        
            var username = name;
            $("form").submit(function(e) {
                e.preventDefault(); // Pour pas que la page se recharge
                socket.emit("MessageSend",username, $("#msg").val()) //Envoyer au socket la val de #msg
                $("#msg").val(""); // On vide pr pouvoir renvoyer un msg 

                element = document.getElementById('test');
				        element.scrollTop = element.scrollHeight;
                return false;
            });
         
            socket.on('MessageSend', function(name,msg){
              element = document.getElementById('test');
				      element.scrollTop = element.scrollHeight;
              var node = document.getElementById(defaultId+'0');
              console.log(defaultId);
              node.insertAdjacentHTML('beforeend', '<div class="message"> <div class="icon"><img class="responsive-img" src="./ProfilDefault.png"/></div> <div class="body"> <div class="user-name">'+name+'</div><div class="hour">'+hour+'</div> <div class="content">'+msg+'</div> </div> </div>');

            });
        });
    </script>
    
</body>
</html>