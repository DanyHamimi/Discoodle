<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Discoodog</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel="stylesheet" href="chatpage.css">
    <script src='/socket.io/socket.io.js'></script>
    <script src='https://code.jquery.com/jquery-3.4.1.min.js'></script>

</head>
<body style="background-color: #2c2f33;">
    <div class="content-box">
        <div class="send">
            <form action="">
                <input id = "msg" autocomplete="off" /><button>Envoyer</button>
            </form>
        </div>
    </div>
    <div id="message"></div>
    
    <script>
        function get(name){
            var url = window.location.search;
            var num = url.search(name);
            var namel = name.length;
            var frontlength = namel+num+1; //length of everything before the value 
            var front = url.substring(0, frontlength);  
            url = url.replace(front, "");  
            num = url.search("&");

            if(num>=0) return url.substr(0,num); 
            if(num<0)  return url;             
        }
        $(function (){
            var socket = io();
            var username = get("name");
            $("form").submit(function(e) {
                e.preventDefault(); // Pour pas que la page se recharge
                socket.emit("MessageSend",username, $("#msg").val()) //Envoyer au socket la val de #msg
                $("#msg").val(""); // On vide pr pouvoir renvoyer un msg 
                return false;
            });
         
            socket.on('MessageSend', function(name,msg){
                
                
                var tag = document.createElement("p"); // <p></p>
                var text = document.createTextNode(name+': '+msg); 
                tag.appendChild(text); // <p>TEST TEXT</p>
                var element = document.getElementsByTagName("div")[0];
                element.appendChild(tag);
            });
        });
    </script>
    
</body>
</html>