<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Discooddle</title>
    <link rel='stylesheet' href='https://codepen.io/tutsplus/pen/WROvdG.css'>
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/css/materialize.min.css'>
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css'><link rel="stylesheet" href="./style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src='/socket.io/socket.io.js'></script>
  <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
  <script src='https://code.jquery.com/jquery-3.4.1.min.js'></script>
  <style>
    #video-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, 300px);
      grid-auto-rows: 300px;
    }
    
    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  </style>
  

</head>
<body style="background-color: #2c2f33;">
    <div class="content-box"></div>
    <div id="message"></div>
    
    <div class="container">
        <div class="row-full">
          <div class="col s12 l19">
            <div class="discord-mockup z-depth-3">
              <div class="items-panel">
                <div class="items">
                  <div class="item">
                    <div id="item">
                        <div class="circle-logo">
                          <a href="./home.html">
                            <img src="./logo.png" />
                          </a>
                        </div>
                      <button class="guild-add" onclick='display("C")'>C</button>
                      <button class="guild-add" onclick='display("EA")'>EA</button>
                      <button class="guild-add" onclick='display("M")'>M</button>
                    </div>  
                    <button class="guild-add" onclick="addChan()">+</button>
                  </div>
                </div>
              </div>
          
              <div class="sidebar-panel hide-on-med-and-down" id="module">
                <div class="header">Projet de Programmation</div>
                <div class="items" style="display:none" id="OL"><a href="#">
                    <div class="item trigger-group" data="Progra">Programmation</div>
                    <div class="item trigger-group" data="ea4">EA4</div>
                    <div class="item trigger-group" data="Stats">Stats</div>
                    <div class="item trigger-group" data="Video">Appel Vidéo</div>
                </a></div>
                <div class="items" style="display:none" id="M"><a href="#">
                  <div class="item trigger-group" data="Progra">Programmation</div>
                  <div class="item trigger-group" data="Cours M1">Cours M1</div>
                  <div class="item trigger-group" data="Cours M2">Cours M2</div>
                  <div class="item trigger-group" data="Video">Appel Vidéo</div>
                </a></div>
                <div class="items" style="display:none" id="C"><a href="#">
                  <div class="item trigger-group" data="Progra">Programmation</div>
                  <div class="item trigger-group" data="Cours C1">Cours C1</div>
                  <div class="item trigger-group" data="Cours C2">Cours C2</div>
                  <div class="item trigger-group" data="Video">Appel Vidéo</div>
                </a></div>
                <div class="items" style="display:none" id="EA"><a href="#">
                  <div class="item trigger-group" data="Progra">Programmation</div>
                  <div class="item trigger-group" data="Cours EA1">Cours EA1</div>
                  <div class="item trigger-group" data="Cours EA2">Cours EA2</div>
                  <div class="item trigger-group" data="Cours EA3">Cours EA3</div>
                  <div class="item trigger-group" data="Video">Appel Vidéo</div>
                </a></div>
                
                <div class="user-bas">
                  <div class="circle-logo"><img src="./img/0.png" id="imageid"/></div><h3 id="name-user-bas"></h3>
                  <script src="profile.js"></script>
                  <script>
                    var profile_link;
                    async function a(){
                      profile_link = await getProfilePictureUrl();
                      user_name = await getUsername();
                      document.getElementById("imageid").src= profile_link;
                      document.getElementById("name-user-bas").innerHTML = user_name;
                    }
                    a();
                  </script>
                  <button id="button" class="buttonmute"><i class="fa fa-phone"></i></button>
                        <script>var button = document.getElementById('button');
                          i = 0;
                          button.addEventListener('click', function() {
                              if (i == 0){
                                this.innerHTML = "<i class=\"fa fa-microphone\"></i>";
                                initVid();
                                unmuteMic();
                              }
                              else{
                                this.innerHTML = "<i class=\"fa fa-microphone-slash\"></i>";
                                leftCall();
                              }
                              i = (i+1)%2;
                          }, false);</script>
                </div>
              </div>
               
              <div class="messages-panel" id="messages-panel">
                <div class="test" id="test">
                  <div class="messages-group hide-unless-show" id="Progra">
                    <div class="header">Général</div>
                    <div class="messages" id = "Progra0">
                      <script>
                         
                      </script>
                    </div>
                  </div>
                  <div class="messages-group hide-unless-show" id="ea4">
                    <div class="header">ea4</div>
                    <div class="messages" id = "ea40">
                      <script>
                       
                    </script>
                    </div>
                  </div>
                  <div class="messages-group hide-unless-show" id="Cours C1">
                    <div class="header">Cours C1</div>
                    <div class="messages" id = "Cours C10">
                      <div class="message"><div class="icon"><img class="responsive-img" src="./ProfilDefault.png"/></div> <div class="body"> <div class="user-name">Professeur</div><div class="hour"></div> <div class="content"><h1>Explications</h1></br>•L'exécution de programme commence toujours dans la fonction main:int main(void){    }</br>•main() doit retourner un entier, la valeur 0 indique terminaison correcte du programme, une valeur > 0 un terminaison incorrecte</br>•La fonction printf() est définie dans le fichier en-tête stdio.h  sert à faire afficher les valeurs d'expressions</br><h3>Compiler le programme C</h3>compiler un programme qui se trouve dans fichier hello.c sur un terminal :</br>gcc -Wall hello.c -o hello </br>gcc - le compilateur C</br>-Wall   une option de compilateur (obligatoire). Permet de voir tous les avertissements (warning).  Compilation avec des avertissements signifie que le programme est presque sûrement  incorrect (mais si la compilation réussie).Exécuter le programma compilé depuis le terminal :</br>./hello </div> </div> </div>
                      
                    </div>
                  </div>
                  <div class="messages-group hide-unless-show" id="Cours C2">
                    <div class="header">Cours C2</div>
                    <div class="messages" id = "Cours C20">
                      <div class="message"> <div class="icon"><img class="responsive-img" src="./ProfilDefault.png"/></div> <div class="body"> <div class="user-name">Professeur</div><div class="hour"></div> <div class="content"><h1>préprocesseur -> compilation -> linkage</h1>Quand on lance  gcc il y a derrière trois programmes différents qui s'exécutent à tour de rôle : </br>1.Le préprocesseurs transforme le texte du programme en utilisant les directives de préprocesseur commençant par #. Le résultat c'est un fichier texte qui contient le texte de programme mais sans directives de preprocesseur.  </br>2.Le compilateur traduit  le texte du programme vers un code binaire  qui n'est pas encore exécutable. Il manque, par exemple, les fonctions de la bibliothèque standard, comme printf(). </br>3.Le linker rassemble les différentes parties du code binaire, ajoute les références vers les fonctions des bibliothèques. Le résultat est un code binaire  exécutable sur la machine.</div> </div> </div>
                    </div>
                  </div>
                  <div class="messages-group hide-unless-show" id="Cours EA1">
                    <div class="header">Cours EA1</div>
                    <div class="messages" id = "Cours EA10">
                      <div class="message"> <div class="icon"><img class="responsive-img" src="./ProfilDefault.png"/></div> <div class="body"> <div class="user-name">Professeur</div><div class="hour"></div> <div class="content"><h1>Thème du cours: Algorithmie</h1>algorithmique = « conception et analyse des algorithmes»</br>algorithme = « méthode (systématique) de résolution d’un problème » concept non limité à l’informatique – d’ailleurs, de nombreux algorithmesont été décrits bien avant l’invention des ordinateurs :</br>•des algorithmes de calcul(opérations arithmétiques, approximation deπ, de√2...)</br>•des constructions géométriques(milieu d’un segment, triangle équilatéral, droites parallèles,centre d’un cercle, pentagone régulier...)</br>•des recettes de cuisine</br>•des manuels de construction...</br>mais le concept a pris une importance particulière avec l’apparition demachines capables d’exécuter</br>fidèlement et rapidement une suite d’opérations prédéfinie</div> </div> </div>
                    </div>
                  </div>
                  <div class="messages-group hide-unless-show" id="Cours EA2">
                    <div class="header">Cours EA2</div>
                    <div class="messages" id = "Cours EA20">
                      <div class="message"> <div class="icon"><img class="responsive-img" src="./ProfilDefault.png"/></div> <div class="body"> <div class="user-name">Professeur</div><div class="hour"></div> <div class="content"><h1>Complexité de l’exponentiation binaire</h1>def puissance(a, n) :</br># version récursiveif n == 0 : return 1# une comparaison</br>tmp = puissance(a, n//2)# une division par 2, un appel récursif</br>carre = tmp * tmp# une multiplication</br>if n%2 == 0 : return carre# une comparaison modulo 2</br>else : return a * carre# une multiplication</div> </div> </div>
                    </div>
                  </div>
                  <div class="messages-group hide-unless-show" id="Cours EA3">
                    <div class="header">Cours EA3</div>
                    <div class="messages" id = "Cours EA30">
                    </div>
                  </div>
                  <div class="messages-group hide-unless-show" id="Cours M1">
                    <div class="header">Cours M1</div>
                    <div class="messages" id = "Cours M10">
                      <div class="message"> <div class="icon"><img class="responsive-img" src="./ProfilDefault.png"/></div> <div class="body"> <div class="user-name">Professeur</div><div class="hour"></div> <div class="content"><h1>1.  ARITHMÉTIQUE</h1>L’arithmétique est l’étude des nombres entiers. On note Z l’ensemble des entiers relatifs, et Nl’ensemble des entiers naturels, càd positifs ou nuls. Si a∈Z, on note|a|sa valeur absolue qui est donc dans N. <h3>1.1.Divisibilité</h3><h5>Définition 1.1</h5>Soient a,b∈Z. On dit que a divise b, ou que a est un diviseur de b, ou que b est un multiple de a, et on note a|b si il existe k ∈ Z tel que b=k×a</div> </div> </div>
                    </div>
                  </div>
                  <div class="messages-group hide-unless-show" id="Cours M2">
                    <div class="header">Cours M2</div>
                    <div class="messages" id = "Cours M20">
                      <div class="message"> <div class="icon"><img class="responsive-img" src="./ProfilDefault.png"/></div> <div class="body"> <div class="user-name">Professeur</div><div class="hour"></div> <div class="content"><h1>1.4.PGCD, PPCM.</h1><h5>Définition  1.12.</h5>Soient a,b∈Z non  nuls.  On  dit  que d∈Z est  un  diviseur commun de a etb si d|a et d|b. </br>On dit que m∈Z est un multiple commun de a et b si a|m et b|m.<h5> 1.13</h5>.Les diviseurs communs de 60 et 90 sont 1, 2, 3, 5, 6, 10, 15 et30.</br>-1 et 1 sont toujours des diviseurs communs de a et b, et le produit ab est toujoursun multiple commun de a et b.</br> L’ensemble des diviseurs et multiples communs dedeux entiers donnés n’est donc jamais vide.</br> Si c est un diviseur commun de a,b,alors|c| ≤ |a|et|c| ≤ |b|, l’ensemble des diviseurs communs est borné et donc fini, donc il en existe un plus grand.</br> De même, l’ensemble des multiples communspositif sest minoré, donc il en existe un plus petit.</div> </div> </div>
                    </div>
                  </div>

                  <div class="messages-group hide-unless-show" id="Stats">
                    <div class="header">Stats</div>
                    <div class="messages">
                      <div class="message"  id = "Stats0">
                        <div class="icon"><img class="responsive-img" src="./ProfilDefault.png"/></div>
                        <div class="body">
                          <div class="user-name">Gnar</div>
                          <div class="content">Non-embedded message.</div>
                        </div>
                      </div>
                    </div>
                  </div>


                  <!-- WebRTC Integration - Sur clic du bouton-->
                  <div class="messages-group hide-unless-show" id="Video">
                    <div class="header">Vidéo chat</div>
                    <div class="messages">
                      <div class="main-video">
                        <button onclick="initVid(),style.display = 'none'">Appel Vidéo</button>
                        
                        <div id="video-grid"></div>
                      </div>
                    </div>
                  </div>


                </div>
                <div class="msg-input">
                  <form id= "msgform" action="" class="msg-form">
                    <input id = "msg" autocomplete="off" class="msg-input" placeholder="Écrivez votre message ici !"/>
                  </form>
                  <form method="post" enctype="multipart/form-data" action="/upload">
                    <label for="file-upload" class="custom-file-upload">
                       +
                  </label>
                    <input id="file-upload" type="file" name="file" accept=".jpg, .jpeg, .png" onchange="this.form.submit()">
                    <input type="hidden" id="uname" value="rayan" name="uname">
                  </form>
                </div>
              </div>
             
            </div>
            
          </div>
        </div>
    </div>
    <div id="result"></div>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script><script  src="./script.js"></script><script  src="./video.js"></script>
    <script>
      var a = 69;
        function get(name){
            var url = window.location.search;
            var num = url.search(name);
            var namel = name.length;
            var frontlength = namel+num+1; //length of everything before the value 
            var front = url.substring(0, frontlength);  
            url = url.replace(front, "");  
            num = url.search("&");
            if(num>=0) return url.substr(0,num); 
            if(num<0)  return url;             
        }


        function addChan(){
          a++;
          var res = String.fromCharCode(a);
          document.getElementById('item').insertAdjacentHTML('beforeEnd','<button class="guild-add">' + res + '</button>');
        }

        function enableEmo(elem) {
          document.querySelector('#msg').value += elem.textContent;
        }

        function display(elemt) {
          var x = document.getElementById(elemt);
          var ea = document.getElementById("EA");
          var ol = document.getElementById("OL");
          var c = document.getElementById("C");
          var m = document.getElementById("M");
          if (!x){
            var test = "SELECT * FROM `cours` WHERE libelle_cours = "+elemt;
            //console.log(test);
            socket.emit('sql-select', "SELECT * FROM `cours` WHERE libelle_cours = "+'"'+elemt+'"', (result) =>{
             //console.log(result);
              socket.emit('sql-select', "SELECT * FROM `modules` WHERE id_cours = "+'"'+result[0].id_cours+'"', (res) =>{
                console.log(res);
                console.log(res.length)

                document.getElementById('module').insertAdjacentHTML('beforeEnd','<div class="items" style="display:none" id="'+result[i].libelle_cours+'"><a id="'+result[i].libelle_cours+'test" href="#"></a></div>');
                  var j = 0;
                  for (let i = 0; i < res.length; i++) {
                    var toto = result[0].libelle_cours+"test";
                    console.log(toto);
                    document.getElementById(toto).insertAdjacentHTML('beforeEnd','<div class="item trigger-group" data="'+ res[i].libelle_module+ '">'+ res[i].libelle_module+ '</div>');
                  }
                
                });
                  
            })
          }
          if (x.style.display === "none") {
            if(x === ea){
              ol.style.display = "none";
              c.style.display = "none";
              m.style.display = "none";  
            }
            if(x === ol){
              ea.style.display = "none";
              c.style.display = "none";
              m.style.display = "none";  
            }
            if(x === m){
              ea.style.display = "none";
              c.style.display = "none";
              ol.style.display = "none";  
            }
            if(x === c){
              ea.style.display = "none";
              ol.style.display = "none";
              m.style.display = "none";  
            }
            x.style.display = "block";            
          }
        } 
          var t;
          async function b(uid){
            t = await getOtherProfilePictureUrl(uid);
            console.log(t);
            return t;
          }

        $(function (){
        
          var socket = io();
            const def = "Utilisateur";
            const name = "test";
            socket.emit('user-created',name);
            socket.emit('checklog');
          
          	socket.emit('sql-select', "SELECT * FROM `cours` WHERE 1", (result) =>{
              //console.log(result);
              var test = "test";
              for (let i = 0; i < result.length; i++) {
                document.getElementById('item').insertAdjacentHTML('beforeEnd','<button class="guild-add" onclick=\'display("'+result[i].libelle_cours+'")\'>' + result[i].libelle_cours + '</button>');
              }
            })
            
            socket.emit('user-created',name);
            socket.emit('checklog');
            var idArray = [];
            $('.messages').each(function () {
              idArray.push(this.id);
            });

            for (const element of idArray) {
                socket.emit('join-channel',element);
            }
            
            if(localStorage.getItem("nom") !== null){
              var tabhome = document.getElementById(localStorage.getItem("nom"));
              if(tabhome.style.display = "none"){
                display(localStorage.getItem("nom"));
                console.log(localStorage.getItem("nom"));
                localStorage.removeItem("nom");
              }
            }
            socket.on('checklog',()=>{
              console.log('FAIT');
              window.location.href = "log.html"
            })
            document.getElementById("uname").setAttribute('value',name);  
            var username = name;
            $("#msgform").submit(function(e) {
                e.preventDefault(); // Pour pas que la page se recharge
                
                socket.emit("MessageSend",username, $("#msg").val(),new Date(),defaultId+0,getCookie("uid"),profile_link); //Envoyer au socket la val de #msg
                $("#msg").val(""); // On vide pr pouvoir renvoyer un msg 

                element = document.getElementById('test');
				        element.scrollTop = element.scrollHeight;
                return false;
            });
           
            socket.on('MessageSend', function(name,msg,hour,channel1,usid,prfPic){
              if (channel1 == defaultId+'0'){
                var node = document.getElementById(defaultId+'0');
                console.log(defaultId);
                node.insertAdjacentHTML('beforeend', '<div class="message"> <div class="icon"><img class="responsive-img" src="'+prfPic+'"/></div> <div class="body"> <div class="user-name">'+name+'</div><div class="hour">'+hour+'</div> <div class="content">'+msg+'</div> </div> </div>');
                element = document.getElementById('test');
                element.scrollTop = element.scrollHeight;
              }
            });

            socket.on('OldSend', function(name,msg,hour,channel,prPic){
              element = document.getElementById('test');
				      element.scrollTop = element.scrollHeight;
              var node = document.getElementById(channel);
              if(node != null){
                node.insertAdjacentHTML('beforeend', '<div class="message"> <div class="icon"><img class="responsive-img" src="'+prPic+'"/></div> <div class="body"> <div class="user-name">'+name+'</div><div class="hour">'+hour+'</div> <div class="content">'+msg+'</div> </div> </div>');
              }
            })

            socket.on('ImageSend', function(name,img){
              element = document.getElementById('test');
				      element.scrollTop = element.scrollHeight;
              var node = document.getElementById(defaultId+'0');
              console.log(defaultId);
              node.insertAdjacentHTML('beforeend', '<div class="message"><div class="icon"><img class="responsive-img" src="./ProfilDefault.png"/></div> <div class="body"> <div class="user-name">'+name+'</div> <div class="content"> <img src="'+img+'" style="max-width: 500px;"/></div> </div> </div>');
            });
        });
    </script>
    
</body>
</html>