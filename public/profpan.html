<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>Panel Admin</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link rel="stylesheet" href="scripts/style.css">
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/css/materialize.min.css'>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css'>
  <script src='https://code.jquery.com/jquery-3.4.1.min.js'></script>
  <script src='/socket.io/socket.io.js'></script>
  <script src='scripts/script.js'></script>
</head>
<body>
  <script>
    function getCookie(name) {
    // Split cookie string and get all individual name=value pairs in an array
    var cookieArr = document.cookie.split(";");
    
    // Loop through the array elements
    for(var i = 0; i < cookieArr.length; i++) {
        var cookiePair = cookieArr[i].split("=");
        
        /* Removing whitespace at the beginning of the cookie name
        and compare it with the given string */
        if(name == cookiePair[0].trim()) {
            // Decode the cookie value and return
            return decodeURIComponent(cookiePair[1]);
        }
    }
    
    // Return null if not found
    return null;
    }
    var socket = io();
    socket.emit('sql-select', "SELECT * FROM `users` WHERE id_user = "+getCookie("uid"), (result) =>{
      if(result[0].usertype!=1){
        window.location.href = "/home.html";
      }
    })
  </script>
  <div class="row">
    <div class="col s12 m3 l3">
      <div class="sidenav">
          <h3>Discoodog</h3><hr/>
        
          <div class="subnav">
            <ul>
              <li><a href="/index.html"><i class="fa fa-home" aria-hidden="true"></i> Accueil</a></li>
              <li><a class="active" href="/profile.html"><i class="fa fa-address-card" aria-hidden="true"></i> Profil</a></li>
              <li><a href="index.html"><i class="fa fa-paper-plane" aria-hidden="true"></i> Messages</a></li>
              <li><a href="https://www.google.com/"><i class="fa fa-life-ring" aria-hidden="true"></i> Préférences</a></li>
              <li><a href="writeArticle.html"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> Écrire un article</a></li>
            </ul>
          </div>
          
      </div> 
    </div>
      <div class="col s12 m8 l9">
          <div id="container_logo">
              <img src="content/logo.png" alt="Logo" />
          </div>
      <div>
 
     <div class="col s12 m8 l9" id="main">
        <h2 id="center">Panel Professeur</h2><hr/>
        <h2 id="center" style="font-size: 200%;">Création de Cours pour vos classes</h2><hr/>
        <table class="tabadmin" style="width: 100%;">
          <tbody id="createcours">
            <tr>
              <td style="width: 10%;" class="tdadmin">Nom de la classe</td>
              <td style="width: 10%;" class="tdadmin">Nom du cours que vous souhaitez créer</td>
            </tr>
          </tbody>
        </table>
        <h2 id="center" style="font-size: 200%;">Gestion de vos cours</h2><hr/>
        <table class="tabadmin" style="width: 100%;">
          <tbody id="Liste modules">
            <tr>
              <td style="width: 33%;" class="tdadmin">Nom du cours</td>
              <td style="width: 33%;" class="tdadmin">Classe affectée à ce cours</td>
              <td style="width: 430px;" class="tdadmin">Nom du module à créer</td>
            </tr>
          </tbody>
        </table>
        <table class="tabadmin" style="width: 100%;">
          <tbody id="listallusers">
            <tr>
              <td style="width: 10%;" class="tdadmin">Nom de la classe</td>
              <td style="width: 10%;" class="tdadmin">Nom du cours</td>
              <td style="width: 139px;" class="tdadmin">Nom du module</td>
              <td style="width: 139px;" class="tdadmin">Actions Classe (créer nouveau cours pour celle ci)</td>
              <td style="width: 430px;" class="tdadmin">Actions sur Le cours et le Module</td>
            </tr>
          </tbody>
        </table>
        <script>
          var node = document.getElementById("listallusers");
          var nodeCreate = document.getElementById("createcours");
          var nodeModule = document.getElementById("Liste modules");
          socket.emit('sql-select', 'SELECT * FROM `classes` WHERE `id_user` = '+getCookie("uid")+' ORDER BY `classes`.`id_classe` DESC', (results) => {
            results.forEach(element => {
              var Cours = element.id_classe;
              nodeCreate.insertAdjacentHTML('beforeend', '<tr> <td style="width: 161px;" class="tdnom" >'+element.libelle_classe+'</td>  </td><td style="width: 142px;" class="tdnom"><input type="text" id="'+Cours+'" value=""> <button id="'+Cours+"a"+'" type="button" style="color: black;">Créer le cours</button></td>');
                var message = document.getElementById(Cours);
                        document.getElementById(Cours+"a").addEventListener("click", function() {
                        if(message.value.length>0){
                        console.log(Cours);
                        console.log(message.value);
                        socket.emit('sql-update', 'INSERT INTO `cours`(`libelle_cours`, `id_classe`) VALUES ("'+message.value+'","'+Cours+'")', (results) => {
                          console.log("SUCCES")
                        });
                        message.value = "";
                        }
                        });
                socket.emit('sql-select', 'SELECT * FROM `cours` WHERE `id_classe` = '+element.id_classe+'', (resultat) => {
                resultat.forEach(element2 => {
                  var Module = element2.libelle_cours;
                  nodeModule.insertAdjacentHTML('beforeend', '<tr> <td style="width: 161px;" class="tdnom" >'+element2.libelle_cours+'</td> <td style="width: 161px;" class="tdnom" >'+element.libelle_classe+'</td>  </td><td style="width: 142px;" class="tdnom"><input type="text" id="'+Module+'" value=""> <button id="'+Module+"a"+'" type="button" style="color: black;">Créer le module</button></td>');
                  var message2 = document.getElementById(Module);
                        document.getElementById(Module+"a").addEventListener("click", function() {
                        if(message2.value.length>0){
                        console.log(Module);
                        console.log(message2.value);
                        socket.emit('sql-update', 'INSERT INTO `modules`(`libelle_module`, `id_cours`) VALUES ("'+message2.value+'","'+element2.id_cours+'")', (results) => {
                          console.log("SUCCES")
                        });
                        message2.value = "";
                        }
                        });
                  socket.emit('sql-select', 'SELECT * FROM `modules` WHERE `id_cours` = '+element2.id_cours+'', (results2) => {
                    results2.forEach(element3=>{

                      node.insertAdjacentHTML('beforeend', '<tr> <td style="width: 161px;" class="tdnom">'+element.libelle_classe+'</td> <td style="width: 139px;" class="tdnom">'+element2.libelle_cours+'</td> <td style="width: 81px;" class="tdnom">'+element3.libelle_module+' </td><td style="width: 142px;" class="tdnom"></td>');

                    });
                  });
                });
              });
            });
          })
        </script>
      </div>
  </div>
  
 
          
</body>
</html>